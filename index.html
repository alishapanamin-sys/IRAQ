<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fortune Wheel</title>
  <style>
    :root{
      --bg1:#7b2cf6;
      --bg2:#5a17d6;
      --panel:#5b1fd8;
      --gold:#f3c33a;
      --gold2:#e1aa15;
      --cream:#f6e3b6;
      --red:#c3121a;
      --text:#ffffff;
      --muted:rgba(255,255,255,.85);
      --shadow: 0 16px 50px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Kufi Arabic", "Noto Sans Arabic", sans-serif;
      min-height:100vh;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text);
      padding:24px;
    }
    .wrap{ width:min(430px, 100%); text-align:center; }
    .card{
      background: radial-gradient(120% 120% at 50% 0%, #8e4dff 0%, var(--panel) 55%, #4711b7 100%);
      border-radius:28px;
      padding:22px 18px 18px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }
    .title{
      font-weight:900;
      letter-spacing:.5px;
      margin:6px 0 2px;
      font-size:34px;
      line-height:1.05;
      text-transform:uppercase;
    }
    .subtitle{ margin:0 0 14px; color:var(--muted); font-size:14px; }

    .wheel-area{
      margin: 8px auto 14px;
      position:relative;
      width: min(340px, 100%);
      aspect-ratio: 1 / 1;
      display:grid;
      place-items:center;
    }
    .rim{
      position:absolute; inset:0;
      border-radius:50%;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.08) 0 52%, rgba(0,0,0,.0) 53%),
                  radial-gradient(circle at 50% 50%, rgba(0,0,0,.22) 0 65%, rgba(0,0,0,0) 66%);
      pointer-events:none;
      filter: drop-shadow(0 20px 30px rgba(0,0,0,.35));
    }
    canvas{ width:100%; height:100%; border-radius:50%; }
    .pointer{
      position:absolute;
      top:-8px;
      left:50%;
      transform:translateX(-50%);
      width:0;height:0;
      border-left:16px solid transparent;
      border-right:16px solid transparent;
      border-bottom:36px solid var(--gold);
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.35));
    }
    .pointer:after{
      content:"";
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      top:28px;
      width:18px;height:18px;
      background: #2b2b2b;
      border-radius:50%;
      border: 3px solid rgba(255,255,255,.25);
      box-shadow: 0 8px 16px rgba(0,0,0,.35);
    }
    .hub{
      position:absolute;
      width:72px;height:72px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 25%, #3a3a3a, #111 70%);
      border: 4px solid rgba(243,195,58,.75);
      box-shadow: 0 16px 26px rgba(0,0,0,.35);
      pointer-events:none;
    }

    .btn{
      width: min(280px, 100%);
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      border:none;
      color:#ffffff;
      font-weight:900;
      padding:14px 18px;
      border-radius:12px;
      cursor:pointer;
      font-size:16px;
      box-shadow: 0 14px 26px rgba(0,0,0,.35);
      transition: transform .06s ease;
      text-transform:uppercase;
    }
    .btn:active{ transform: translateY(1px) scale(.995); }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; }

    .foot{
      margin-top:12px;
      font-size:12px;
      color: rgba(255,255,255,.78);
      line-height:1.4;
    }

    /* modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:999;
    }
    .modal{
      width:min(420px, 100%);
      background: #15151a;
      border-radius:18px;
      padding:18px;
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 24px 60px rgba(0,0,0,.5);
      text-align:right;
    }
    .modal h3{ margin:0 0 10px; font-size:18px; }
    .modal p{
      margin:0 0 14px;
      color: rgba(255,255,255,.86);
      font-size:14px;
      line-height:1.55;
      white-space:pre-line;
    }
    .modal .row{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-start; }
    .ghost{
      background: transparent;
      border: 1px solid rgba(255,255,255,.18);
      color: #fff;
      padding:12px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      flex: 1 1 140px;
    }
    .cta{
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      border:none;
      color:#fff;
      padding:12px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      flex: 1 1 160px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="app" class="card">
      <div class="title">FORTUNE<br>WHEEL</div>
      <p class="subtitle">ŸÑŸÅ ÿßŸÑÿπÿ¨ŸÑÿ© Ÿàÿ¥ŸàŸÅ ŸáÿØŸäÿ™ŸÉ üëá</p>

      <div class="wheel-area">
        <div class="pointer" aria-hidden="true"></div>
        <div class="rim" aria-hidden="true"></div>
        <canvas id="wheel" width="800" height="800" aria-label="Fortune Wheel"></canvas>
        <div class="hub" aria-hidden="true"></div>
      </div>

      <button id="spinBtn" class="btn">GET STARTED</button>

      <div class="foot">
        Ÿáÿ∞ÿß ÿ≥ÿ≠ÿ®/ÿ™ÿ¨ÿ±ÿ®ÿ© ‚Äî ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸàŸÇÿØ ÿ™ÿÆÿ™ŸÑŸÅ.
      </div>
    </div>
  </div>

  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3 id="modalTitle">ŸÖÿ®ÿ±ŸàŸÉ! üéâ</h3>
      <p id="modalText"></p>
      <div class="row">
        <button class="ghost" id="closeModal">ÿ•ÿ∫ŸÑÿßŸÇ</button>
        <button class="cta" id="goCpa">ŸÖÿ™ÿßÿ®ÿπÿ©</button>
      </div>
    </div>
  </div>

  <script>
    // ====== ÿ±ÿßÿ®ÿ∑ CPA ======
    const CPA_URL = "https://adsmain.bountyads.store/?utm_medium=24c9e8ead1a61abc4ca11515604da84dbebe69ba&utm_campaign=spent";

    // ====== ÿµŸàÿ± ÿßŸÑŸáÿØÿßŸäÿß (SVG ŸÉÿµŸàÿ± ŸÖÿØŸÖÿ¨ÿ©) ======
    const ICONS = {
      iphone: svgData(`
        <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#0b0b0b"/>
              <stop offset="1" stop-color="#2a2a2a"/>
            </linearGradient>
            <linearGradient id="scr" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0" stop-color="#1b2cff"/>
              <stop offset="1" stop-color="#8a2be2"/>
            </linearGradient>
          </defs>
          <rect x="70" y="22" width="80" height="176" rx="18" fill="url(#g1)"/>
          <rect x="78" y="38" width="64" height="140" rx="12" fill="url(#scr)" opacity=".95"/>
          <circle cx="110" cy="182" r="7" fill="#111" stroke="#555" stroke-width="3"/>
          <rect x="92" y="28" width="36" height="6" rx="3" fill="#444"/>
          <circle cx="132" cy="44" r="6" fill="#111" stroke="#666" stroke-width="2"/>
          <circle cx="132" cy="44" r="3" fill="#2aa7ff"/>
          <path d="M95 110c18 10 28 10 46 0" stroke="#fff" stroke-opacity=".35" stroke-width="10" stroke-linecap="round"/>
        </svg>
      `),
      samsung: svgData(`
        <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
          <defs>
            <linearGradient id="b" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#04102b"/>
              <stop offset="1" stop-color="#0c3c9a"/>
            </linearGradient>
            <linearGradient id="s" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0" stop-color="#00d4ff"/>
              <stop offset="1" stop-color="#4b00ff"/>
            </linearGradient>
          </defs>
          <rect x="68" y="18" width="84" height="184" rx="20" fill="url(#b)"/>
          <rect x="78" y="36" width="64" height="148" rx="14" fill="url(#s)" opacity=".95"/>
          <circle cx="110" cy="190" r="6" fill="#163b8f"/>
          <circle cx="94" cy="30" r="5" fill="#163b8f"/>
          <circle cx="110" cy="30" r="5" fill="#163b8f"/>
          <circle cx="126" cy="30" r="5" fill="#163b8f"/>
        </svg>
      `),
      airpods: svgData(`
        <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
          <defs>
            <linearGradient id="w" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0" stop-color="#ffffff"/>
              <stop offset="1" stop-color="#e9e9e9"/>
            </linearGradient>
          </defs>
          <rect x="62" y="30" width="96" height="160" rx="26" fill="url(#w)" stroke="#d0d0d0" stroke-width="6"/>
          <rect x="74" y="64" width="24" height="96" rx="12" fill="#fff" stroke="#d0d0d0" stroke-width="4"/>
          <rect x="122" y="64" width="24" height="96" rx="12" fill="#fff" stroke="#d0d0d0" stroke-width="4"/>
          <path d="M76 58h88" stroke="#d8d8d8" stroke-width="8" stroke-linecap="round"/>
          <circle cx="86" cy="112" r="6" fill="#cfcfcf"/>
          <circle cx="134" cy="112" r="6" fill="#cfcfcf"/>
        </svg>
      `),
      giftcard: svgData(`
        <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
          <defs>
            <linearGradient id="gc" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#111111"/>
              <stop offset="1" stop-color="#2b2b2b"/>
            </linearGradient>
          </defs>
          <rect x="38" y="74" width="144" height="88" rx="16" fill="url(#gc)"/>
          <rect x="38" y="74" width="144" height="28" rx="16" fill="#f3c33a"/>
          <rect x="56" y="118" width="62" height="14" rx="7" fill="#3a3a3a"/>
          <rect x="128" y="114" width="38" height="22" rx="10" fill="#f6e3b6"/>
          <circle cx="110" cy="118" r="10" fill="#c3121a"/>
          <path d="M103 118h14" stroke="#fff" stroke-opacity=".5" stroke-width="4" stroke-linecap="round"/>
        </svg>
      `),
      surprise: svgData(`
        <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
          <rect x="60" y="80" width="100" height="110" rx="14" fill="#c3121a"/>
          <rect x="60" y="80" width="100" height="26" rx="14" fill="#f3c33a"/>
          <rect x="106" y="80" width="14" height="110" fill="#f3c33a"/>
          <path d="M92 80c-14-16 6-30 20-12 14-18 34-4 20 12" fill="#f6e3b6"/>
          <circle cx="110" cy="104" r="5" fill="#fff" opacity=".6"/>
          <circle cx="92" cy="126" r="4" fill="#fff" opacity=".45"/>
          <circle cx="134" cy="142" r="4" fill="#fff" opacity=".45"/>
        </svg>
      `),
      tryagain: svgData(`
        <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220">
          <circle cx="110" cy="110" r="74" fill="#111"/>
          <circle cx="86" cy="96" r="10" fill="#f6e3b6"/>
          <circle cx="134" cy="96" r="10" fill="#f6e3b6"/>
          <path d="M80 148c12-12 48-12 60 0" stroke="#f6e3b6" stroke-width="12" stroke-linecap="round" fill="none"/>
          <path d="M110 60a50 50 0 1 1-35 15" stroke="#f3c33a" stroke-width="10" fill="none" stroke-linecap="round"/>
          <path d="M68 74l8 20 18-10" fill="#f3c33a"/>
        </svg>
      `),
    };

    function svgData(svg){
      return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg.trim());
    }

    // ====== ÿ¥ÿ±ÿßÿ¶ÿ≠ ÿßŸÑÿπÿ¨ŸÑÿ© (ÿµŸàÿ± ŸÅŸÇÿ∑) ======
    const prizes = [
      { key:"iphone",   type:"win",  weight: 3 },
      { key:"samsung",  type:"win",  weight: 4 },
      { key:"airpods",  type:"win",  weight: 6 },
      { key:"giftcard", type:"win",  weight: 12 },
      { key:"surprise", type:"win",  weight: 10 },
      { key:"tryagain", type:"lose", weight: 42 },
      { key:"giftcard", type:"win",  weight: 12 },
      { key:"tryagain", type:"lose", weight: 42 },
      { key:"airpods",  type:"win",  weight: 6 },
      { key:"tryagain", type:"lose", weight: 42 },
      { key:"surprise", type:"win",  weight: 10 },
      { key:"tryagain", type:"lose", weight: 42 },
    ];

    const sliceColors = prizes.map((_, i) => (i % 2 === 0 ? getCss('--red') : getCss('--cream')));
    function getCss(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

    // preload icons
    const iconImgs = {};
    const iconKeys = Object.keys(ICONS);
    let loadedCount = 0;

    function preloadAll(){
      return new Promise((resolve) => {
        iconKeys.forEach(k=>{
          const img = new Image();
          img.onload = img.onerror = ()=>{
            loadedCount++;
            if (loadedCount === iconKeys.length) resolve();
          };
          img.src = ICONS[k];
          iconImgs[k] = img;
        });
      });
    }

    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalText = document.getElementById("modalText");
    const closeModal = document.getElementById("closeModal");
    const goCpa = document.getElementById("goCpa");

    const W = canvas.width, H = canvas.height;
    const cx = W/2, cy = H/2;
    const radius = Math.min(W,H)*0.44;

    let currentAngle = -Math.PI/2;
    let spinning = false;

    function weightedPick(items){
      const total = items.reduce((s,x)=>s + (x.weight||1), 0);
      let r = Math.random() * total;
      for (const it of items){
        r -= (it.weight||1);
        if (r <= 0) return it;
      }
      return items[items.length - 1];
    }

    function drawWheel(angle){
      ctx.clearRect(0,0,W,H);

      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(angle);

      const n = prizes.length;
      const step = (Math.PI*2)/n;

      for(let i=0;i<n;i++){
        const start = i*step;
        const end = start + step;

        // slice
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,radius,start,end);
        ctx.closePath();
        ctx.fillStyle = sliceColors[i];
        ctx.fill();

        // slice border
        ctx.strokeStyle = "rgba(0,0,0,.22)";
        ctx.lineWidth = 6;
        ctx.stroke();

        // icon only
        const mid = start + step/2;
        const img = iconImgs[prizes[i].key];
        if (img && img.complete){
          ctx.save();
          ctx.rotate(mid);

          const size = 120;
          const dist = radius - 62;
          const x = dist - size;
          const y = -size/2;

          ctx.shadowColor = "rgba(0,0,0,.25)";
          ctx.shadowBlur = 12;
          ctx.drawImage(img, x, y, size, size);

          ctx.restore();
        }
      }

      // inner ring
      ctx.beginPath();
      ctx.arc(0,0,radius+10,0,Math.PI*2);
      ctx.strokeStyle = "rgba(0,0,0,.35)";
      ctx.lineWidth = 18;
      ctx.stroke();

      // gold rim
      ctx.beginPath();
      ctx.arc(0,0,radius+2,0,Math.PI*2);
      ctx.strokeStyle = "rgba(243,195,58,.85)";
      ctx.lineWidth = 8;
      ctx.stroke();

      // dots around rim
      const dots = 28;
      for(let d=0; d<dots; d++){
        const a = (Math.PI*2) * (d/dots);
        const x = Math.cos(a) * (radius+18);
        const y = Math.sin(a) * (radius+18);
        ctx.beginPath();
        ctx.arc(x,y,7,0,Math.PI*2);
        ctx.fillStyle = "rgba(255,255,255,.85)";
        ctx.fill();
        ctx.strokeStyle = "rgba(0,0,0,.25)";
        ctx.lineWidth = 3;
        ctx.stroke();
      }

      ctx.restore();
    }

    function angleToIndex(globalAngle){
      const n = prizes.length;
      const step = (Math.PI*2)/n;
      const a = ( (Math.PI*2) - (globalAngle % (Math.PI*2)) + (Math.PI/2) ) % (Math.PI*2);
      return Math.floor(a / step) % n;
    }

    function showResult(item){
      if (item.type === "lose") {
        modalTitle.textContent = "ÿ≠ÿ∏ ÿ£ŸàŸÅÿ± üôÇ";
        modalText.textContent = "ŸÑŸÑÿ£ÿ≥ŸÅ ŸÖÿß ÿµÿßÿ± ŸÜÿµŸäÿ®ŸÉ ŸáÿßŸÑŸÖÿ±ÿ©.\nÿßÿ∂ÿ∫ÿ∑ ŸÖÿ™ÿßÿ®ÿπÿ© Ÿàÿ¥ŸàŸÅ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿ™ÿßÿ≠.";
      } else {
        modalTitle.textContent = "ŸÖÿ®ÿ±ŸàŸÉ! üéâ";
        modalText.textContent = "ŸÖÿ®ÿ±ŸàŸÉ! ÿ±ÿ®ÿ≠ÿ™ ŸáÿØŸäÿ© üéÅ\nÿßÿ∂ÿ∫ÿ∑ ŸÖÿ™ÿßÿ®ÿπÿ© ŸÑŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿ™ÿßÿ≠.";
      }
      modalBackdrop.style.display = "flex";
    }

    closeModal.addEventListener("click", ()=> modalBackdrop.style.display = "none");
    modalBackdrop.addEventListener("click", (e)=> { if(e.target === modalBackdrop) modalBackdrop.style.display="none"; });
    goCpa.addEventListener("click", ()=> { window.location.href = CPA_URL; });

    // init
    preloadAll().then(()=> drawWheel(currentAngle));

    spinBtn.addEventListener("click", ()=>{
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;

      const picked = weightedPick(prizes);
      const candidates = prizes.map((p,i)=>({p,i})).filter(x=>x.p.key===picked.key && x.p.type===picked.type);
      const chosenIndex = candidates[Math.floor(Math.random()*candidates.length)].i;

      const n = prizes.length;
      const step = (Math.PI*2)/n;

      const targetA = (chosenIndex + 0.5) * step;
      const endAngleBase = (Math.PI*2 + Math.PI/2 - targetA) % (Math.PI*2);

      const spins = 7 + Math.random()*2;
      const endAngle = endAngleBase + spins*(Math.PI*2);

      const startAngle = currentAngle;
      const duration = 3800;
      const start = performance.now();

      const easeOutCubic = (t)=> 1 - Math.pow(1-t, 3);

      function anim(now){
        const t = Math.min(1, (now - start)/duration);
        const e = easeOutCubic(t);
        currentAngle = startAngle + (endAngle - startAngle) * e;
        drawWheel(currentAngle);

        if (t < 1) requestAnimationFrame(anim);
        else {
          spinning = false;
          spinBtn.disabled = false;
          const idx = angleToIndex(currentAngle);
          showResult(prizes[idx]);
        }
      }
      requestAnimationFrame(anim);
    });
  </script>
</body>
</html>

